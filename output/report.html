<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>项目研发进程总结</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
		<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
		<style>
			@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;900&family=JetBrains+Mono:wght@300;800&display=swap');
			:root { --bg: #ffffff; --text: #000000; --line: #eeeeee; }
			body { background: var(--bg); color: var(--text); font-family: 'Inter', 'Noto Sans SC', sans-serif; margin: 0; overflow: hidden; }
			.swiper { width: 100vw; height: 100vh; }
			.slide-container { height: 100%; display: flex; flex-direction: column; padding: 12% 10% 8% 10%; border-right: 1px solid var(--line); }
			.page-num { font-family: 'JetBrains Mono'; font-size: 10px; color: #bbb; margin-bottom: 10px; border-left: 2px solid #000; padding-left: 8px; }
			.section-label { font-size: 10px; text-transform: uppercase; color: #888; letter-spacing: 2px; font-family: 'JetBrains Mono'; }
			.huge-title { font-size: 3.2rem; font-weight: 900; line-height: 1.1; letter-spacing: -2px; margin: 10px 0; }
			.title-small { font-size: 2.2rem !important; }
			.divider { width: 100%; height: 1px; background: var(--line); margin: 20px 0; }
			.data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 10px; }
			.grid-item { border-top: 1px solid #000; padding-top: 8px; }
			.grid-val { font-weight: 900; font-size: 16px; font-family: 'JetBrains Mono'; }
			.grid-label { font-size: 9px; color: #999; margin-top: 2px; }
			.desc-p { font-size: 12px; line-height: 1.8; color: #444; margin-top: auto; font-weight: 300; text-align: justify; }
			.data-list { font-size: 10px; font-family: 'JetBrains Mono'; margin-top: 15px; border-top: 1px solid var(--line); }
			.list-row { display: flex; justify-content: space-between; border-bottom: 1px solid var(--line); padding: 5px 0; }
		</style>
	</head>
	<body>
		<div class="swiper">
			<div class="swiper-wrapper" id="root"></div>
		</div>

		<script>
			// 注入 processed_summary.json 数据
			const d = {"project_metadata":{"generated_at":"2025-12-31T16:20:28.633619469+08:00","local_timezone":"+08:00","total_commits":9,"total_authors":1,"bus_factor":1,"last_commit_time":"2025-12-31T06:48:11+00:00","time_range":{"start":"1767143856","end":"1767163691"}},"workload_stats":{"total_insertions":3440,"total_deletions":1366,"net_lines":2074,"refactor_ratio":0.4,"code_retention_rate":0.0},"author_leaderboard":[{"name":"merwinM0","email":"18358511710@139.com","commit_count":9,"insertions":3440,"deletions":1366,"impact_score":20.6,"active_days":1,"avg_cycle_time_hours":0.0,"preferred_work_hours":"Standard","role":"Maintainer"}],"temporal_trends":{"daily_commits":{"2025-12-31":9},"hourly_distribution":{"00":0,"01":0,"02":0,"03":0,"04":0,"05":0,"06":0,"07":0,"08":0,"09":2,"10":1,"11":0,"12":0,"13":3,"14":3,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0},"weekly_distribution":{"Wed":9}},"file_system_analysis":{"hotspots":[{"path":"src/main.rs","change_count":8,"unique_authors":1,"risk_level":"Low"},{"path":"summary.md","change_count":1,"unique_authors":1,"risk_level":"Low"},{"path":"output/processed_summary.json","change_count":2,"unique_authors":1,"risk_level":"Low"},{"path":"output/report.html","change_count":2,"unique_authors":1,"risk_level":"Low"},{"path":"raw_commits.json","change_count":4,"unique_authors":1,"risk_level":"Low"},{"path":"assets/template.html","change_count":2,"unique_authors":1,"risk_level":"Low"},{"path":"Cargo.toml","change_count":3,"unique_authors":1,"risk_level":"Low"},{"path":".gitignore","change_count":1,"unique_authors":1,"risk_level":"Low"},{"path":"Cargo.lock","change_count":3,"unique_authors":1,"risk_level":"Low"},{"path":"processed_summary.json","change_count":4,"unique_authors":1,"risk_level":"Low"}],"language_distribution":{},"file_coupling":[]},"engineering_quality":{"commit_type_distribution":{"unknown":9},"avg_files_per_commit":3.5555555555555554,"gpg_signed_percentage":0.0,"potential_secrets_found":0}};
			
			const formatTs = (ts) => {
				if(!ts || ts === "0") return "未记录";
				const date = new Date(parseInt(ts) * 1000);
				return `${date.getFullYear()}年${date.getMonth()+1}月${date.getDate()}日`;
				};
				
				const slides = [
				{
					tag: "01 / 起源", title: "工程规模",
					main: d.project_metadata.total_commits, unit: "累计提交次数",
					grid: [
					["开发者数", d.project_metadata.total_authors],
					["核心人数", d.project_metadata.bus_factor],
					["项目起点", formatTs(d.project_metadata.time_range.start)],
					["本地时区", d.project_metadata.local_timezone]
					],
					desc: "项目自 " + formatTs(d.project_metadata.time_range.start) + " 开启首个逻辑字节。由 " + d.project_metadata.total_authors + " 位成员共同构建。"
					},
					{
						tag: "02 / 演进", title: "逻辑负载",
						main: d.workload_stats.net_lines, unit: "现存有效行数",
						grid: [
						["累计新增", "+" + d.workload_stats.total_insertions],
						["累计删除", "-" + d.workload_stats.total_deletions],
						["重构系数", d.workload_stats.refactor_ratio],
						["留存率", d.workload_stats.code_retention_rate]
						],
						desc: "代码仓库经历了 " + d.workload_stats.total_insertions + " 行的新增与 " + d.workload_stats.total_deletions + " 行的删除。"
						},
						{
							tag: "03 / 贡献", title: "核心作者",
							main: d.author_leaderboard[0].impact_score, unit: "最高影响力得分",
							isList: true,
							listData: d.author_leaderboard.map(a => [a.name, a.impact_score + " pts"]),
							desc: "核心贡献者偏向 " + d.author_leaderboard[0].preferred_work_hours + " 作息模式，影响力分值达 " + d.author_leaderboard[0].impact_score + "。"
							},
							{
								tag: "04 / 脉冲", title: "研发节律",
								isChart: true, chartId: "pulseChart",
								grid: [
								["活跃周峰", "周三"],
								["周活跃量", (d.temporal_trends.weekly_distribution.Wed || 0) + "c"],
								["签名比例", d.engineering_quality.gpg_signed_percentage.toFixed(1) + "%"]
								],
								desc: "24 小时脉冲分布图揭示了团队的认知高点。目前系统安全签名比例为 " + d.engineering_quality.gpg_signed_percentage.toFixed(1) + "%。"
								},
								{
									tag: "05 / 轨迹", title: "贡献足迹",
									isChart: true, chartId: "heatChart",
									desc: "每日提交频率的波动图谱。记录了项目从启动至今每一天的研发强度。"
									},
									{
										tag: "06 / 热点", title: "震中观测",
										isList: true,
										listData: d.file_system_analysis.hotspots.map(h => [h.path.split('/').pop(), "风险:" + h.risk_level]),
										desc: "内部变动最频繁的热点文件修订监控。当前震中风险等级评估为 " + d.file_system_analysis.hotspots[0].risk_level + "。"
										},
										{
											tag: "07 / 总结", title: "记录·未完待续",
											isSmallTitle: true,
											main: d.project_metadata.total_commits + "c", unit: "全生命周期足迹",
											grid: [
											["总作者数", d.project_metadata.total_authors],
											["报告状态", "已封存"]
											],
											desc: "截止 " + new Date(d.project_metadata.generated_at).toLocaleDateString() + "，" + d.project_metadata.total_commits + " 次提交记录了工程的进化轨迹。"
										}
										];
										
										const root = document.getElementById('root');
										root.innerHTML = slides.map(s => `
										<div class="swiper-slide">
										<div class="slide-container">
										<div class="page-num">${s.tag}</div>
										<div class="section-label">DEVELOPMENT SUMMARY</div>
										<h1 class="huge-title ${s.isSmallTitle ? 'title-small' : ''}">${s.title}</h1>
										<div class="divider"></div>
										${s.main ? `<div class="huge-title" style="font-size: 2.5rem; margin-top: 5px;">${s.main}</div><div class="section-label">${s.unit}</div>` : ''}
										${s.isChart ? `<div id="${s.chartId}" style="height:200px; width:100%; margin-top:10px;"></div>` : ''}
										<div class="data-grid">${s.grid ? s.grid.map(m => `<div class="grid-item"><div class="grid-val">${m[1]}</div><div class="grid-label">${m[0]}</div></div>`).join('') : ''}</div>
										${s.isList ? `<div class="data-list">${s.listData.slice(0, 6).map(l => `<div class="list-row"><span>${l[0]}</span><span style="color:#888">${l[1]}</span></div>`).join('')}</div>` : ''}
										<p class="desc-p">${s.desc}</p>
										</div>
										</div>
										`).join('');
										
										const swiper = new Swiper('.swiper', {
											direction: 'vertical',
											mousewheel: true,
											speed: 800,
											on: {
												init: () => { renderCharts(); },
												slideChangeTransitionEnd: () => { renderCharts(); }
											}
											});
											
											function renderCharts() {
												// 1. 研发脉冲图 (适配纯数字键)
												const pulseEl = document.getElementById('pulseChart');
												if(pulseEl) {
													const myChart = echarts.init(pulseEl);
													const rawData = d.temporal_trends.hourly_distribution;
													const values = [];
													for(let i=0; i<24; i++) {
														const key = i.toString().padStart(2, '0');
														values.push(rawData[key] || rawData[i] || 0); // 兼容 "09" 或 9
													}
													myChart.setOption({
														grid: { top: 30, bottom: 30, left: 10, right: 10 },
														xAxis: {
															type: 'category',
															data: Array.from({length: 24}, (_, i) => i + 'h'),
															axisLabel: { interval: 3, color: '#bbb', fontSize: 9 }
															},
															yAxis: { show: false },
															series: [{ data: values, type: 'bar', itemStyle: { color: '#000' } }]
															});
														}
														
														// 2. 贡献足迹图 (强化渲染逻辑)
														const heatEl = document.getElementById('heatChart');
														if(heatEl) {
															const heatChart = echarts.init(heatEl);
															const dailyData = d.temporal_trends.daily_commits;
															const sortedEntries = Object.entries(dailyData).sort((a, b) => new Date(a[0]) - new Date(b[0]));
															
															// 如果数据点太少，补全前后日期以形成线段
															let dates = sortedEntries.map(e => e[0]);
															let counts = sortedEntries.map(e => e[1]);
															
															heatChart.setOption({
																grid: { top: 40, bottom: 40, left: 20, right: 20 },
																xAxis: {
																	type: 'category',
																	data: dates,
																	show: true,
																	axisLabel: { color: '#ccc', fontSize: 10, rotate: 0 }
																	},
																	yAxis: { show: false },
																	series: [{
																		data: counts,
																		type: 'line',
																		smooth: 0.3,
																		symbol: 'circle',
																		symbolSize: 8,
																		lineStyle: { color: '#000', width: 2 },
																		areaStyle: { color: 'rgba(0,0,0,0.05)' }
																		}]
																		});
																	}
																}
		</script>
	</body>
</html>
